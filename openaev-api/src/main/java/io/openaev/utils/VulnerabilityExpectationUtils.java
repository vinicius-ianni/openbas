package io.openaev.utils;

import io.openaev.database.model.Agent;
import io.openaev.database.model.Asset;
import io.openaev.database.model.AssetGroup;
import io.openaev.database.model.InjectExpectationSignature;
import io.openaev.model.expectation.VulnerabilityExpectation;
import jakarta.validation.constraints.NotBlank;
import jakarta.validation.constraints.NotNull;
import java.util.List;
import java.util.Objects;
import javax.annotation.Nullable;

/**
 * Utility class for creating vulnerability expectations.
 *
 * <p>Provides factory methods for creating vulnerability expectations targeted at different levels:
 * agents, assets, or asset groups. Vulnerability expectations track whether specific
 * vulnerabilities can be exploited on target systems.
 *
 * <p>This is a utility class and cannot be instantiated.
 *
 * @see io.openaev.model.expectation.VulnerabilityExpectation
 */
public class VulnerabilityExpectationUtils {

  private VulnerabilityExpectationUtils() {}

  /**
   * Creates a vulnerability expectation for a specific agent.
   *
   * <p>Agent-level expectations are the most granular, tracking vulnerability exploitation on a
   * specific agent deployed on an asset.
   *
   * @param score the expected score (defaults to 100.0 if null)
   * @param name the expectation name (must not be blank)
   * @param description optional description of the expectation
   * @param agent the target agent (must not be null)
   * @param asset the asset the agent is deployed on (must not be null)
   * @param assetGroup optional asset group context
   * @param expirationTime optional expiration time in milliseconds
   * @param injectExpectationSignatures signatures for matching results
   * @return a configured vulnerability expectation
   */
  public static VulnerabilityExpectation vulnerabilityExpectationForAgent(
      @Nullable final Double score,
      @NotBlank final String name,
      final String description,
      @NotNull final Agent agent,
      @NotNull final Asset asset,
      final AssetGroup assetGroup,
      final Long expirationTime,
      List<InjectExpectationSignature> injectExpectationSignatures) {
    VulnerabilityExpectation vulnerabilityExpectation = new VulnerabilityExpectation();
    vulnerabilityExpectation.setScore(Objects.requireNonNullElse(score, 100.0));
    vulnerabilityExpectation.setName(name);
    vulnerabilityExpectation.setDescription(description);
    vulnerabilityExpectation.setAgent(agent);
    vulnerabilityExpectation.setAsset(asset);
    vulnerabilityExpectation.setAssetGroup(assetGroup);
    vulnerabilityExpectation.setExpirationTime(expirationTime);
    vulnerabilityExpectation.setInjectExpectationSignatures(injectExpectationSignatures);
    return vulnerabilityExpectation;
  }

  /**
   * Creates a vulnerability expectation for a specific asset.
   *
   * <p>Asset-level expectations track vulnerability exploitation on an asset without specifying a
   * particular agent. If an asset group is provided, the expectation is marked as a group
   * expectation.
   *
   * @param score the expected score (defaults to 100.0 if null)
   * @param name the expectation name (must not be blank)
   * @param description optional description of the expectation
   * @param asset the target asset (must not be null)
   * @param assetGroup optional asset group context
   * @param expirationTime optional expiration time in milliseconds
   * @return a configured vulnerability expectation
   */
  public static VulnerabilityExpectation vulnerabilityExpectationForAsset(
      @Nullable final Double score,
      @NotBlank final String name,
      final String description,
      @NotNull final Asset asset,
      final AssetGroup assetGroup,
      final Long expirationTime) {
    VulnerabilityExpectation vulnerabilityExpectation = new VulnerabilityExpectation();
    vulnerabilityExpectation.setScore(Objects.requireNonNullElse(score, 100.0));
    vulnerabilityExpectation.setName(name);
    vulnerabilityExpectation.setDescription(description);
    vulnerabilityExpectation.setAsset(asset);
    vulnerabilityExpectation.setAssetGroup(assetGroup);
    vulnerabilityExpectation.setExpectationGroup(assetGroup != null);
    vulnerabilityExpectation.setExpirationTime(expirationTime);
    return vulnerabilityExpectation;
  }

  /**
   * Creates a vulnerability expectation for an asset group.
   *
   * <p>Group-level expectations track vulnerability exploitation across all assets in a group
   * without targeting specific individual assets.
   *
   * @param score the expected score (defaults to 100.0 if null)
   * @param name the expectation name (must not be blank)
   * @param description optional description of the expectation
   * @param assetGroup the target asset group (must not be null)
   * @param expectationGroup whether to use group validation mode
   * @param expirationTime optional expiration time in milliseconds
   * @return a configured vulnerability expectation
   */
  public static VulnerabilityExpectation vulnerabilityExpectationForAssetGroup(
      @Nullable final Double score,
      @NotBlank final String name,
      final String description,
      @NotNull final AssetGroup assetGroup,
      final boolean expectationGroup,
      final Long expirationTime) {
    VulnerabilityExpectation vulnerabilityExpectation = new VulnerabilityExpectation();
    vulnerabilityExpectation.setScore(Objects.requireNonNullElse(score, 100.0));
    vulnerabilityExpectation.setName(name);
    vulnerabilityExpectation.setDescription(description);
    vulnerabilityExpectation.setAssetGroup(assetGroup);
    vulnerabilityExpectation.setExpectationGroup(expectationGroup);
    vulnerabilityExpectation.setExpirationTime(expirationTime);
    return vulnerabilityExpectation;
  }
}
